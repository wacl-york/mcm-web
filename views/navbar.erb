
<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
  <div class="container">
    <a class="navbar-brand" href="/">MCM</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav me-auto mb-2 mb-md-0">
        <li class="nav-item">
          <a class="nav-link <%= 'active' if current_url? '/' %>" aria-current="page"
             href="<%= rel '/' %>">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link <%= 'active' if current_url? '/browse' %>" aria-current="page"
             href="<%= rel '/browse' %>">Browse</a>
        </li>
        <li class="nav-item">
          <a class="nav-link <%= 'active' if current_url? '/search' %>" aria-current="page"
             href="<%= rel '/search' %>">Search</a>
        </li>
        <li class="nav-item">
          <a class="nav-link <%= 'active' if current_url? '/export' %>" aria-current="page"
             href="<%= rel '/export' %>">Export</a>
        </li>
      </ul>
    </div>
    <select class="form-inline search-bar" id="tom-select-search" placeholder="Start typing a species formula or name...">
    </select>
  </div>
</nav>
<script>
  var settings = {
    maxItems: 1,
    maxOptions: 50,
    loadThrottle: 500,
    closeAfterSelect: true,
    valueField: 'Species',
    searchField: ['Species', 'Synonyms', 'Smiles', 'Inchi'],
    sortField: [{field: 'score', direction: 'desc'}, {field: '$score'}],
    options: [],
    create: false,
    load: function(query, callback) {
      // Clear previously found results, otherwise they will be kept at the top regardless of their match
      this.clearOptions();
      var url = "/search-synonym?q=" + encodeURIComponent(query);
      fetch(url)
        .then(response => response.json())
        .then(json => {
          callback(json);
        }).catch(() => {
          callback();
        });
    },
    render: {
      option: function(item, escape) {
          return `<div class="py-2 d-flex">
                      <div class="icon me-3">
                          <img class="img-fluid" src="species_images/${ escape(item.Species) }.png" />
                      </div>
                      <div>
                          <div class="mb-1">
                              <span class="h4">
                                  ${ escape(item.Species) }
                              </span>
                          </div>
                          <div class="description">
                              ${ escape(item.Synonyms) }
                              <br>
                              Smiles: ${ escape(item.Smiles) }
                              <br>
                              Inchi: ${ escape(item.Inchi) }
                          </div>
                      </div>
                  </div>`;
      },
      item: function(item, escape) {
          return `<div class="py-2 d-flex">
                      <div class="icon me-3">
                          <img class="img-fluid" src="species_images/${ escape(item.Species) }.png" />
                      </div>
                      <div>
                          <div class="mb-1">
                              <span class="h4">
                                  ${ escape(item.Species) }
                              </span>
                          </div>
                          <div class="description">
                              ${ escape(item.Synonyms) }
                              <br>
                              Smiles: ${ escape(item.Smiles) }
                              <br>
                              Inchi: ${ escape(item.Inchi) }
                          </div>
                      </div>
                  </div>`;
      }
    },
    onItemAdd: function(value, item) {
      window.location.href = "species/" + value;
    }
  };
new TomSelect('#tom-select-search', settings);
</script>
