<h1><%= @species[:Name] %></h1>
<button class="btn btn-primary" onclick="addToMarklist('<%= @species[:Name] %>')">
  Add to mark list
</button>
<br>
<br>

<div class="card">
  <div class="card-header">
    Species information
  </div>
  <ul class="list-group list-group-flush">
    <li class="list-group-item">Smiles: <%= @species[:Smiles] %></li>
    <li class="list-group-item">InChI: <%= @species[:Inchi] %></li>
    <li class="list-group-item">Mass: <%= @species[:Mass] %></li>
    <li class="list-group-item">Synonyms: <%= @synonyms%></li>
    <li class="list-group-item">
      External links:
      <a href="http://www.google.com/search?q=<%= @species[:Inchi] %>">Google</a>,
      <a href="http://www.chemspider.com/Search.aspx?q=<%= @species[:Inchi] %>">ChemSpider</a>,
      <a href='http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?db=pccompound&term="<%= @species[:Inchi] %>"[inchi]'>PubChem</a>,
      <a href="http://webbook.nist.gov/cgi/cbook.cgi?Name=<%= @species[:Inchi] %>">NIST WebBook</a>,
      <a href="http://iupac.pole-ether.fr/cgi-bin/Compound.cgi?nameType=InChI&name=<%= @species[:Inchi] %>">IUPAC</a>,
      <a href="http://era-orleans.org/eradb/index.php?fonctionnalite=inchi&inchi=<%= @species[:Inchi] %>">ERADB</a>,
      <a href="http://www.ebi.ac.uk/chebi/advancedSearchFT.do?searchString=<%= @species[:Inchi] %>">ChEBI</a>
    </li>
  </ul>

</div>

<br>

<h3 class="rxn-title">Sink Reactions</h3>
<% @sink_rxns.each do |reaction| %>
  <%== display_reaction(reaction, @species[:Name]) %>
<% end %>

<h3 class="rxn-title">Precursor Reactions</h3>
<% @precursor_rxns.each do |reaction| %>
  <%== display_reaction(reaction, @species[:Name]) %>
<% end %>

<script>
  function addToMarklist(x) {
    var curr_marklist = getCookie('marklist');
    if (curr_marklist.search(x+'($|,)') == -1) {
      let sep = curr_marklist == '' ? '' : ',';
      setCookie('marklist', curr_marklist + sep + x);
      refreshMarklist();
    }
  }

  function refreshMarklist() {
    var ml = document.getElementById('marklist');
    species = getCookie('marklist').split(',');
    species.forEach(function(x) {
      var li = document.createElement("li");
      li.setAttribute("class", "marklist-item");
      li.setAttribute("id", "ml-" + x);
      li.textContent = x;

      var remove_button = document.createElement("button");
      remove_button.setAttribute("type", "button");
      remove_button.setAttribute("class", "btn btn-danger btn-small");
      remove_button.setAttribute("onclick", "removeFromMarklist('"+x+"')");
      remove_button.textContent = '-';

      li.appendChild(remove_button);
      ml.appendChild(li);
    });
  }

  function setCookie(cname, cvalue) {
    let expires="Session";
    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/;SameSite=Strict;";
  }

  function getCookie(cname) {
    let name = cname + "=";
    let ca = document.cookie.split(';');
    for(let i = 0; i < ca.length; i++) {
      let c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
  }

  function checkCookie() {
    let user = getCookie("username");
    if (user != "") {
      alert("Welcome again " + user);
    } else {
      user = prompt("Please enter your name:", "");
      if (user != "" && user != null) {
        setCookie("username", user, 365);
      }
    }
  }

  function clearMarklist() {
    setCookie('marklist', '');
    var ml = document.getElementById('marklist');
    ml.replaceChildren();
  }

  function removeFromMarklist(x) {
    // Remove species from cookie
    var curr_cookie = getCookie('marklist');
    re = new RegExp(x + '\\b,?')
    curr_cookie = curr_cookie.replace(re, "")
    curr_cookie = curr_cookie.replace(/,$/, "")  // If the target species was last there will be a trailing comma
    setCookie('marklist', curr_cookie);

    // Remove species from marklist
    var ele = document.getElementById('ml-' + x);
    ele.remove();
  }
</script>
